#! /usr/bin/perl

package sortable;

use strict;
use warnings;

use EnsEMBL::Web::Object::Data::Opentab;
use EnsEMBL::Web::Object::Data::User;
use EnsEMBL::Web::RegObj;
use CGI;


my $cgi = new CGI;
 
my $registry_user = $ENSEMBL_WEB_REGISTRY->get_user;
my $user = EnsEMBL::Web::Object::Data::User->new({ id => $registry_user->id });

if ($user) {

  my $found = 0;
  my $tab = undef;
  foreach my $open_tab (@{ $user->opentabs }) {
    if ($open_tab->name eq $cgi->param('name')) {
      $tab = $open_tab;
    }
  }

  if (!$tab) {
    $tab = EnsEMBL::Web::Object::Data::Opentab->new();
  }

  $tab->user_id($user->id);
  $tab->tab($cgi->param('tab'));
  $tab->name($cgi->param('name'));
  $tab->save;

}

print "Content-type: text/plain\n\n";
print "Done";

1;
