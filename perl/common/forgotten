#! /usr/bin/perl

package forgotten;

use strict;
use warnings;

use CGI;
use EnsEMBL::Web::Object::User;
use EnsEMBL::Web::SpeciesDefs;
use EnsEMBL::Web::Mailer::User;

my $cgi = new CGI;
my $url = "/login.html?url=/index.html";

if ($cgi->param('email')) {
  my $user = EnsEMBL::Web::Object::User->new({ adaptor => $ENSEMBL_WEB_REGISTRY->userAdapator, email => $cgi->param('email') });
  if ($user->id) {
    $url = "/updated_password.html?url=/index.html";
    $user->salt($user->random_string(8));
    $user->save;
    my $mailer = EnsEMBL::Web::Mailer::User->new();
    $mailer->email($user->email);
    $mailer->send_reactivation_email($user->name, $user->activation_link);
  } else {
    $url = "/forgotten_no_user.html?url=/index.html";
  }
}

CGI::redirect($url);

1;
