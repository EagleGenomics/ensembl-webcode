<html>
  <head>
    <meta name="navigation" content="Configuration" />
    <title>Configuring your Ensembl species</title>
  </head>
<body>
  <h2>Configuring your Ensembl species</h2>

<p>The default species for Ensembl are listed in this file:</p>
<p><kbd>public-plugins/ensembl/conf/SiteDefs.pm</kbd> 
<p> in %__species_aliases.  These are automatically imported into the main conf/SiteDefs::ENSEMBL_SPECIES_ALIASES.
In this distribution all the default species are enabled. (See below on 
<a href="#customise">how to customise</a> your own list).

<p>The keys of the hash (the species names on the left hand side) define the list of valid species for
this website. The values of the hash (the aliases on the right) can be used in URLs instead of the longer
species names. i.e.</p>
<kbd><a href="/mouse/contigview?l=1:4m-4.1m">http://my.ensembl.site/mouse/contigview</a></kbd>
<p>is identical to</p>
<kbd><a href="/Mus_musculus/contigview?l=1:4m-4.1m">http://my.ensembl.site/Mus_musculus/contigview</a></kbd>


<p>To configure a species it has to have an appropriately-named .ini file in the 
conf/ini_files directory and to be present as in the %__species_aliases as shown below:</p>

<pre>
sub update_conf {
  $SiteDefs::ENSEMBL_PERL_SPECIES  = 'Homo_sapiens'; # Default species
  $SiteDefs::__species_aliases{ 'Bos_taurus'      } = [qw(bt cow moo)];
  $SiteDefs::__species_aliases{ 'Canis_familiaris'} = [qw(cf dog)];
  $SiteDefs::__species_aliases{ 'Homo_sapiens'    } = [qw(hs human man default)];
}
</pre>

<h3 id="customise" class="boxed">Customising your species list</h3>
<p>To overwrite the default species and customise your own species list 
add lines (described below) to the "update_conf" method in <strong>your mirror plugin</strong>: 
<kbd>public-plugins/mirror/conf/SiteDefs.pm</kbd>.
</p>
<ol>
  <li>To delete a species:<br />
  <tt>&nbsp; &nbsp; delete( $SiteDefs::__species_aliases{'Bos_taurus'} );</tt>
  </li>
  <li>To add a new species:<br />
  <tt>&nbsp; &nbsp; $SiteDefs::__species_aliases{'New_species'} = [qw(ns new)];</tt>
  </li>
  <li>To add an additional alias to a species:<br />
  <tt>&nbsp; &nbsp; push @{$SiteDefs::__species_aliases{'Pan_troglodytes'}}, qw(chimpanzee);</tt>
  </li>
</ol>

<p>Remember to <a href="configure.html#species_ini">create an ini file</a> for each of the species in 
<kbd>public-plugins/mirror/conf/ini-files/&lt;Genus_species&gt;.ini</kbd>.  If you put your changes 
into the public-plugins/mirror directory, they will not be overridden when you next do a cvs update.</p>

<p>You might also want to change $SiteDefs::ENSEMBL_PERL_SPECIES - this is a special alias for 
URLs of the form http://my.ensembl.site/perl/contigview, for purely historical reasons. It will 
probably be used in the future to set the default species for multi-species pages/functions.</p>

<p>Once you are happy with your ini files, run the utility script <kbd>utils/update_webdb.pl</kbd>,
which will update ensembl_website with species information (assembly IDs, etc) for that release.
Although not essential for the running of an Ensembl site, this database is used by several 
static content utilities as well as the news and help pages. 

<h3 class="boxed">Static content for your species</h3>

<p>A new species needs at a minimum, a directory and home page:</p>
<ul class="spaced">
<li><kbd>public-plugins/mirror/htdocs/[Genus_species]/</kbd></li>
<li><kbd>public-plugins/mirror/htdocs/[Genus_species]/index.html</kbd></li>
</ul>

<p>If you would like your species home page to match that of the existing Ensembl site,
you will need the following:</p>

<ol class="spaced">
<li>A subdirectory <kbd>public-plugins/mirror/htdocs/[Genus_species]/ssi/</kbd></li>
<li>An index page copied from a similar species. There are only two variations 
on the species home page, depending on whether the genome has been assembled 
into chromosomes or not. Both versions have four smaller HTML files that are placed within
the home page using server-side includes; note that you will see errors on the page if
these files do not exist. The files are:
  <ul>
  <li>A block giving access points for the data:
    <ul>
      <li>If a species has no chromosomes, it will need a file
<kbd>htdocs/[Genus_species]/ssi/examples.html</kbd> which should have example 
entry points to the data.</li>
      <li>If the species has chromosomes, it will need a karyotype image, called
<kbd>karyotype_[Genus_species].png</kbd>. The image can be generated in
KaryoView (provided that the site is already correctly configured for 
dynamic content!) and then edited - it should ideally be no more than 250px wide so that
the page won't look cramped at 800x600 resolution! Save the finished file
in <kbd>htdocs/img/species/</kbd> (N.B. the folder is literally called
'species' - don't substitute the name of your new species!).</li>
      <li>After you have made the karyotype, you will need to create a file
<kbd>htdocs/[Genus_species]/ssi/karyomap.html</kbd> - use a similar
species as a template and adjust the imagemap areas and URLs to match
the new karyotype.</li>
    </ul></li>
  <li>A block <kbd>htdocs/[Genus_species]/ssi/about.html</kbd> which
generally should contain a short description of the assembl/annotation 
plus (optionally) a picture of the species. The image should be roughly 100x100px and 
called <kbd>pic_[Genus_species].png</kbd>. Save it in <kbd>htdocs/img/species/</kbd>,
as per the karyotype images.</li>
  <li>Two additional blocks currently show "What's New" and species statistics, which the
Ensembl webteam generate using Perl scripts.
    <ul>
      <li>The species statistics are generated from raw SQL queries against the relevant database(s).
Since the queries depend on the database content, our in-house script may not work with your
data so we recommend writing your own script to generate this file.</li>
      <li>The "What's New" block depends upon content from the news tables in the ensembl_website 
database. If you are using this database to add your own site news, you can run the utility
script <kbd>whatsnew.pl</kbd> to generate this block. If not, you will need to replace it with your
own static content.</li>
    </ul>
  </ul>
</ol>

<h3 class="boxed">The Ensembl home page and site maps</h3>

<p>If you have added or deleted species, you will needed to generate new species lists
for the home page and new site maps (see below).</p>

<p>If you have added species, you will also need a thumbnail image of the species, for use on the 
home page and main sitemap. The image <em>must</em> be 40x40px and called 
<kbd>thumb_[Genus_species].png</kbd>. Save it in <kbd>public-plugins/mirror/htdocs/img/species/</kbd></p>

<h4>Species lists</h4>

<p>These can be manually updated by copying <kbd>mammals.html</kbd> and <kbd>others.html</kbd>
from <kbd>/public-plugins/ensembl/htdocs/ssi/</kbd> to <kbd>/public-plugins/mirror/htdocs/ssi/</kbd>
and then editing them to show your species.</p>

<p>Alternatively you can run the utility script <kbd>utils/homepage.pl</kbd>, as long as you have run
<kbd>utils/update_webdb.pl</kbd> first to put all your configured species into the database.</p>

<blockquote><kbd>./homepage.pl --release=[[SPECIESDEFS::ENSEMBL_VERSION]] --sitetype=mirror</kbd> (substituting the relevant release number)</blockquote>

<p>If your static content is <strong>not</strong> in <kbd>public-plugins/mirror</kbd>, you need to append another flag:</p>

<blockquote><kbd>--mirror=my-plugins/mysite</kbd> (no beginning or trailing slashes).</blockquote> 

<h4>Site maps</h4>

<p>These are generated quickly and easily by running <kbd>utils/sitemap.pl</kbd>. The script uses the 
SEARCH_LINKS hash from the cached configuration to generate individual species site maps, and also
walks the <kbd>/info</kbd> directory to produce a tree of links to site documentation.</p>

<p>The script can be invoked with similar flags to homepage.pl, but does not need a release number.</p>

<p>If you have extended Ensembl by adding new views, you can include them in the site map by editing
the script - see the inline documentation  under 'TO ADD A NEW VIEW'.</p>


</body>
</html>
